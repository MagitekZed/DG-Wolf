<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf Disc Golf Tracker</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --danger: #dc2626;
            --success: #16a34a;
            --bg: #f1f5f9;
            --surface: #ffffff;
            --text: #0f172a;
            --text-light: #64748b;
            --border: #e2e8f0;
            --modal-bg: rgba(0, 0, 0, 0.85);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f172a;
                --surface: #1e293b;
                --text: #f8fafc;
                --text-light: #94a3b8;
                --border: #334155;
            }
        }

        * { box-sizing: border-box; touch-action: manipulation; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 40px; }
        
        /* Layout Utilities */
        .container { max-width: 600px; margin: 0 auto; padding: 16px; padding-top: 70px; } /* Added top padding for fixed header */
        .hidden { display: none !important; }
        .card { background: var(--surface); border-radius: 12px; padding: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 16px; border: 1px solid var(--border); }
        .row { display: flex; gap: 8px; align-items: center; }
        .col { display: flex; flex-direction: column; gap: 4px; flex: 1; }
        .justify-between { justify-content: space-between; }
        
        /* Typography */
        h1, h2, h3, h4 { margin: 0 0 12px 0; }
        p { margin: 0 0 10px 0; line-height: 1.5; color: var(--text-light); }
        .stat-value { font-size: 1.25rem; font-weight: bold; }
        .stat-label { font-size: 0.875rem; opacity: 0.8; }
        .highlight { color: var(--primary); font-weight: bold; }

        /* Navigation Header */
        .nav-header {
            position: fixed; top: 0; left: 0; right: 0;
            height: 60px; background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px; z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .nav-title { font-weight: 800; font-size: 1.2rem; color: var(--primary); }
        .nav-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text); padding: 8px; }

        /* Forms & Buttons */
        input[type="text"], input[type="number"], select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; }
        button { cursor: pointer; border: none; padding: 14px; border-radius: 8px; font-weight: 600; font-size: 1rem; transition: opacity 0.2s; width: 100%; }
        button:active { opacity: 0.8; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text); }
        .btn-sm { padding: 8px; font-size: 0.9rem; }
        
        /* Components */
        .player-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .score-grid { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 8px; font-size: 0.9rem; }
        .score-header { font-weight: bold; padding-bottom: 8px; border-bottom: 2px solid var(--border); }
        .score-row { padding: 12px 0; border-bottom: 1px solid var(--border); align-items: center; display: grid; grid-template-columns: 2fr 1fr 1fr; }
        .wolf-badge { background: var(--danger); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; text-transform: uppercase; margin-left: 6px; display: inline-block; }
        .partner-badge { background: var(--primary); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; text-transform: uppercase; margin-left: 6px; display: inline-block; }
        
        .phase-indicator { text-align: center; margin-bottom: 16px; padding: 8px; background: var(--surface); border-radius: 8px; border: 1px solid var(--border); }
        
        /* Interactive Tooltips */
        .info-icon {
            display: inline-flex; align-items: center; justify-content: center;
            width: 20px; height: 20px; border-radius: 50%;
            background: var(--text-light); color: var(--bg);
            font-size: 12px; font-weight: bold; margin-left: 8px; cursor: pointer;
        }
        .info-box {
            background: var(--bg); border-left: 4px solid var(--primary);
            padding: 10px; margin-top: 8px; border-radius: 4px;
            font-size: 0.9rem; color: var(--text);
        }

        /* Modal Overlay */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--modal-bg); z-index: 1000;
            display: flex; justify-content: center; align-items: flex-end; /* Sheet style on mobile */
        }
        @media(min-width: 600px) { .modal { align-items: center; } }
        
        .modal-content {
            background: var(--surface); width: 100%; max-width: 600px;
            max-height: 90vh; overflow-y: auto;
            border-radius: 16px 16px 0 0; padding: 24px;
            animation: slideUp 0.3s ease-out;
        }
        @media(min-width: 600px) { .modal-content { border-radius: 16px; } }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .modal-close { position: absolute; top: 16px; right: 16px; background: none; border: none; font-size: 1.5rem; color: var(--text); width: auto; padding: 5px; }
        .rule-block { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .rule-block:last-child { border: none; }
    </style>
</head>
<body>

    <nav class="nav-header">
        <div class="nav-title">üê∫ Wolf Tracker</div>
        <button class="nav-btn" onclick="toggleRules()" aria-label="Rules">?</button>
    </nav>

    <div id="rules-modal" class="modal hidden">
        <div class="modal-content">
            <div class="row justify-between">
                <h2>How to Play Wolf</h2>
                <button class="btn-outline btn-sm" style="width: auto;" onclick="toggleRules()">Close</button>
            </div>
            
            <div class="rule-block">
                <h4>1. The Order</h4>
                <p>The "Wolf" rotates every hole. 
                <br><strong>Hole 1:</strong> Player 1 is Wolf. 
                <br><strong>Hole 2:</strong> Player 2 is Wolf, etc.</p>
                <p><em>Tip: On Holes 17 & 18, it is customary for the Last Place player to be the Wolf to catch up. Use the "Change" button in the app to do this.</em></p>
            </div>

            <div class="rule-block">
                <h4>2. The Pick</h4>
                <p>The Wolf tees off first. They watch the next player throw. Immediately after the shot lands, the Wolf must decide:</p>
                <ul>
                    <li><strong>Pick:</strong> That player becomes their partner.</li>
                    <li><strong>Pass:</strong> Wait to see the next player's shot.</li>
                </ul>
                <p>Once you pass a player, you cannot pick them. If you pass everyone, you are the <strong>Lone Wolf</strong> (or forced to take the last player, depending on house rules).</p>
            </div>

            <div class="rule-block">
                <h4>3. Scoring</h4>
                <p><strong>Wolf + Partner Win:</strong> 2 pts each.</p>
                <p><strong>The Pack Wins:</strong> 3 pts each (Pack size doesn't matter).</p>
                <p><strong>Lone Wolf Wins:</strong> 4 pts.</p>
                <p><strong>Blind Wolf:</strong> If declared before anyone throws, points are usually doubled.</p>
            </div>

            <button class="btn-primary" onclick="toggleRules()">Got it</button>
        </div>
    </div>

    <div id="setup-screen" class="container">
        <h3>Game Setup</h3>
        
        <div class="card">
            <h4>Players (Tee Order)</h4>
            <div id="setup-player-list"></div>
            <div class="row" style="margin-top: 10px;">
                <input type="text" id="new-player-name" placeholder="Name">
                <button class="btn-primary" style="width: auto;" onclick="addPlayer()">Add</button>
            </div>
        </div>

        <div class="card">
            <h4>Settings</h4>
            <div class="col" style="margin-bottom: 12px;">
                <label>Total Holes</label>
                <input type="number" id="setup-holes" value="18">
            </div>
            <div class="row justify-between">
                <div style="display:flex; align-items:center;">
                    <label>Carry Over Ties?</label>
                    <span class="info-icon" onclick="toggleInfo('info-carryover')">i</span>
                </div>
                <input type="checkbox" id="setup-carryover" style="width: 24px; height: 24px;">
            </div>
            <div id="info-carryover" class="info-box hidden">
                <strong>Skins Style:</strong> If a hole is tied, no points are awarded immediately. Instead, the value of the hole is added to the "Pot". The next winner takes their standard points PLUS the accumulated Pot multiplier.
            </div>
        </div>

        <div class="card">
            <h4>Point Values</h4>
            <div class="score-grid">
                <div class="col"><label class="stat-label">Team Win</label><input type="number" id="pts-team-win" value="2"></div>
                <div class="col"><label class="stat-label">Pack Win</label><input type="number" id="pts-pack-win" value="3"></div>
            </div>
            <div class="score-grid" style="margin-top: 10px;">
                <div class="col"><label class="stat-label">Lone Wolf</label><input type="number" id="pts-lone-win" value="4"></div>
                <div class="col"><label class="stat-label">Blind Bonus</label><input type="number" id="pts-blind-bonus" value="2"></div>
            </div>
        </div>

        <button class="btn-success" onclick="startGame()">Start Round</button>
    </div>

    <div id="game-screen" class="hidden">
        <div class="container">
            <div class="phase-indicator">
                <h2 id="hole-display">Hole 1</h2>
                <div id="pot-display" class="highlight hidden">POT: 0</div>
            </div>

            <div class="card" style="border-left: 6px solid var(--danger);">
                <div class="row justify-between">
                    <div>
                        <span class="stat-label">Current Wolf</span>
                        <div class="stat-value" id="current-wolf-name">Player Name</div>
                    </div>
                    <div>
                        <button class="btn-outline btn-sm" style="width: auto;" onclick="toggleOverrideWolf()">Change</button>
                        <span class="info-icon" onclick="toggleInfo('info-wolf-override')">i</span>
                    </div>
                </div>
                
                <div id="info-wolf-override" class="info-box hidden">
                    <strong>Override:</strong> Use this if you are playing by the "Last Place is Wolf" rule on holes 17 & 18, or if the rotation got messed up.
                </div>

                <div id="wolf-override-area" class="hidden" style="margin-top: 10px; padding-top:10px; border-top:1px solid var(--border);">
                    <label class="stat-label">Select Manual Wolf:</label>
                    <div class="row">
                        <select id="wolf-select"></select>
                        <button class="btn-primary btn-sm" style="width: auto;" onclick="confirmWolfOverride()">Set</button>
                    </div>
                </div>
            </div>

            <div id="action-area" class="card">
                </div>

            <div class="card">
                <h3>Scoreboard</h3>
                <div class="score-grid score-header">
                    <div>Player</div>
                    <div style="text-align: center;">Hole</div>
                    <div style="text-align: right;">Total</div>
                </div>
                <div id="scoreboard-body"></div>
            </div>

            <div class="row" style="margin-top: 30px;">
                <button class="btn-danger btn-outline" onclick="confirmReset()">End Game & Reset</button>
            </div>
        </div>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        const DEFAULT_STATE = {
            players: [], // { id, name, score }
            settings: {
                totalHoles: 18,
                carryOver: false,
                points: { teamWin: 2, packWin: 3, loneWin: 4, blindBonus: 2 }
            },
            currentHole: 1,
            pot: 0,
            gameActive: false,
            currentWolfId: null,
            partnerId: null, 
            isBlind: false,
            phase: 'PICK' 
        };

        let state = JSON.parse(JSON.stringify(DEFAULT_STATE));

        // --- UI HELPERS ---
        function toggleRules() {
            const modal = document.getElementById('rules-modal');
            modal.classList.toggle('hidden');
        }

        function toggleInfo(id) {
            const el = document.getElementById(id);
            el.classList.toggle('hidden');
        }

        // --- PERSISTENCE ---
        function saveState() {
            localStorage.setItem('wolfDiscGolfState', JSON.stringify(state));
            render();
        }

        function loadState() {
            const saved = localStorage.getItem('wolfDiscGolfState');
            if (saved) {
                state = JSON.parse(saved);
                if (state.gameActive) {
                    showScreen('game-screen');
                    renderGame();
                } else {
                    renderSetup();
                }
            } else {
                renderSetup();
            }
        }

        // --- SETUP LOGIC ---
        function addPlayer() {
            const input = document.getElementById('new-player-name');
            const name = input.value.trim();
            if (!name) return;
            state.players.push({
                id: Date.now().toString(),
                name: name,
                score: 0
            });
            input.value = '';
            renderSetup();
        }

        function removePlayer(id) {
            state.players = state.players.filter(p => p.id !== id);
            renderSetup();
        }

        function startGame() {
            if (state.players.length < 3) {
                alert("Wolf requires at least 3 players (4-5 is best).");
                return;
            }

            state.settings.totalHoles = parseInt(document.getElementById('setup-holes').value);
            state.settings.carryOver = document.getElementById('setup-carryover').checked;
            state.settings.points.teamWin = parseInt(document.getElementById('pts-team-win').value);
            state.settings.points.packWin = parseInt(document.getElementById('pts-pack-win').value);
            state.settings.points.loneWin = parseInt(document.getElementById('pts-lone-win').value);
            state.settings.points.blindBonus = parseInt(document.getElementById('pts-blind-bonus').value);

            state.gameActive = true;
            state.currentHole = 1;
            state.pot = 0;
            state.currentWolfId = state.players[0].id;
            
            startHole();
            showScreen('game-screen');
            saveState();
        }

        // --- GAME LOGIC ---
        function startHole() {
            // Auto-rotate Wolf
            if (state.currentHole > 1) {
                const prevWolfIdx = state.players.findIndex(p => p.id === state.currentWolfId);
                const nextWolfIdx = (prevWolfIdx + 1) % state.players.length;
                state.currentWolfId = state.players[nextWolfIdx].id;
            } else {
                 state.currentWolfId = state.players[0].id;
            }
            
            state.partnerId = null;
            state.isBlind = false;
            state.phase = 'PICK';
            saveState();
        }

        function setPartner(id) {
            state.partnerId = id; 
            state.phase = 'RESULT';
            saveState();
        }

        function toggleBlind() {
            state.isBlind = !state.isBlind;
            if(state.isBlind) {
                state.partnerId = 'LONE'; 
            } else {
                state.partnerId = null;
            }
            saveState();
        }

        function toggleOverrideWolf() {
            const area = document.getElementById('wolf-override-area');
            const select = document.getElementById('wolf-select');
            
            if (area.classList.contains('hidden')) {
                area.classList.remove('hidden');
                select.innerHTML = '';
                state.players.forEach(p => {
                    const opt = document.createElement('option');
                    opt.value = p.id;
                    opt.text = p.name;
                    if(p.id === state.currentWolfId) opt.selected = true;
                    select.appendChild(opt);
                });
            } else {
                area.classList.add('hidden');
            }
        }

        function confirmWolfOverride() {
            const select = document.getElementById('wolf-select');
            state.currentWolfId = select.value;
            document.getElementById('wolf-override-area').classList.add('hidden');
            state.phase = 'PICK';
            state.partnerId = null;
            state.isBlind = false;
            saveState();
        }

        function commitResult(resultType) {
            const wolf = state.players.find(p => p.id === state.currentWolfId);
            const isLone = state.partnerId === 'LONE';
            const partner = !isLone ? state.players.find(p => p.id === state.partnerId) : null;
            
            if (resultType === 'TIE') {
                if (state.settings.carryOver) {
                    state.pot += 1; 
                }
            } else if (resultType === 'WOLF_WIN') {
                let pts = isLone ? state.settings.points.loneWin : state.settings.points.teamWin;
                if (state.isBlind && isLone) pts += state.settings.points.blindBonus;
                
                const multiplier = state.pot + 1;
                const totalPts = pts * multiplier;

                wolf.score += totalPts;
                if (partner) partner.score += totalPts;
                
                state.pot = 0; 
            } else if (resultType === 'PACK_WIN') {
                let pts = state.settings.points.packWin;
                const multiplier = state.pot + 1;
                const totalPts = pts * multiplier;
                
                state.players.forEach(p => {
                    if (p.id !== state.currentWolfId && p.id !== state.partnerId) {
                        p.score += totalPts;
                    }
                });
                state.pot = 0;
            }

            if (state.currentHole < state.settings.totalHoles) {
                state.currentHole++;
                startHole();
            } else {
                state.phase = 'FINISHED';
                saveState();
            }
        }

        function confirmReset() {
            if(confirm("Are you sure? This will delete the current game.")) {
                state = JSON.parse(JSON.stringify(DEFAULT_STATE));
                localStorage.removeItem('wolfDiscGolfState');
                showScreen('setup-screen');
                renderSetup();
            }
        }

        // --- RENDERING ---
        function showScreen(id) {
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById(id).classList.remove('hidden');
        }

        function renderSetup() {
            const list = document.getElementById('setup-player-list');
            list.innerHTML = '';
            state.players.forEach(p => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.innerHTML = `
                    <span>${p.name}</span>
                    <button class="btn-danger btn-sm" style="width:auto" onclick="removePlayer('${p.id}')">‚úï</button>
                `;
                list.appendChild(div);
            });
        }

        function renderGame() {
            if (!state.gameActive) return;

            // Header Stats
            document.getElementById('hole-display').innerText = `Hole ${state.currentHole} / ${state.settings.totalHoles}`;
            const potEl = document.getElementById('pot-display');
            if (state.pot > 0) {
                potEl.innerText = `SKINS CARRY OVER ACTIVE (${state.pot}x)`;
                potEl.classList.remove('hidden');
            } else {
                potEl.classList.add('hidden');
            }

            // Wolf Name
            const wolf = state.players.find(p => p.id === state.currentWolfId);
            document.getElementById('current-wolf-name').innerText = wolf ? wolf.name : 'Unknown';

            // Action Area
            const actionArea = document.getElementById('action-area');
            actionArea.innerHTML = ''; 

            if (state.phase === 'PICK') {
                actionArea.innerHTML = `<h3>Phase 1: The Pick</h3>`;

                // Blind Toggle
                const blindDiv = document.createElement('div');
                blindDiv.style.marginBottom = '16px';
                blindDiv.className = 'row justify-between';
                blindDiv.innerHTML = `
                    <div class="row">
                        <label class="highlight">Blind Wolf?</label>
                        <span class="info-icon" onclick="toggleInfo('info-blind')">i</span>
                    </div>
                    <input type="checkbox" class="checkbox-wrapper" style="width:24px; height:24px" 
                           ${state.isBlind ? 'checked' : ''} onchange="toggleBlind()">
                `;
                actionArea.appendChild(blindDiv);
                
                const blindInfo = document.createElement('div');
                blindInfo.id = 'info-blind';
                blindInfo.className = 'info-box hidden';
                blindInfo.style.marginBottom = '16px';
                blindInfo.innerText = `Declare BEFORE anyone tees off. You play alone (Lone Wolf) but get +${state.settings.points.blindBonus} bonus points if you win.`;
                actionArea.appendChild(blindInfo);

                if (!state.isBlind) {
                    const p = document.createElement('p');
                    p.innerText = 'Watch each player drive. Pick them immediately or pass. If you pass everyone, you are the Lone Wolf.';
                    actionArea.appendChild(p);

                    state.players.forEach(p => {
                        if (p.id !== state.currentWolfId) {
                            const btn = document.createElement('button');
                            btn.className = 'btn-outline';
                            btn.style.marginBottom = '8px';
                            btn.innerText = `Pick ${p.name}`;
                            btn.onclick = () => setPartner(p.id);
                            actionArea.appendChild(btn);
                        }
                    });
                }

                const loneBtn = document.createElement('button');
                loneBtn.className = 'btn-primary';
                loneBtn.style.marginTop = '8px';
                loneBtn.innerText = state.isBlind ? 'Confirm Blind Wolf' : 'Go Lone Wolf';
                loneBtn.onclick = () => setPartner('LONE');
                actionArea.appendChild(loneBtn);

            } else if (state.phase === 'RESULT') {
                actionArea.innerHTML = `<h3>Phase 2: Who Won?</h3>`;
                
                // Matchup Display
                const teamDesc = document.createElement('div');
                teamDesc.style.marginBottom = '16px';
                teamDesc.style.padding = '8px';
                teamDesc.style.background = 'var(--bg)';
                teamDesc.style.borderRadius = '6px';
                
                if (state.partnerId === 'LONE') {
                    teamDesc.innerHTML = `<span class="highlight">${wolf.name}</span> (Lone Wolf) <br>vs<br> The Pack`;
                } else {
                    const partner = state.players.find(p => p.id === state.partnerId);
                    teamDesc.innerHTML = `<span class="highlight">${wolf.name} & ${partner.name}</span> <br>vs<br> The Pack`;
                }
                actionArea.appendChild(teamDesc);

                // Result Buttons
                const btnWolf = document.createElement('button');
                btnWolf.className = 'btn-success';
                btnWolf.style.marginBottom = '8px';
                btnWolf.innerText = state.partnerId === 'LONE' ? 'Wolf Won' : 'Wolf Team Won';
                btnWolf.onclick = () => commitResult('WOLF_WIN');
                actionArea.appendChild(btnWolf);

                const btnPack = document.createElement('button');
                btnPack.className = 'btn-primary';
                btnPack.style.marginBottom = '8px';
                btnPack.innerText = 'The Pack Won';
                btnPack.onclick = () => commitResult('PACK_WIN');
                actionArea.appendChild(btnPack);

                const btnTie = document.createElement('button');
                btnTie.className = 'btn-outline';
                btnTie.innerText = 'Tie / Push Hole';
                btnTie.onclick = () => commitResult('TIE');
                actionArea.appendChild(btnTie);
                
                const btnBack = document.createElement('button');
                btnBack.className = 'btn-outline';
                btnBack.style.marginTop = '16px';
                btnBack.style.padding = '8px';
                btnBack.style.fontSize = '0.8rem';
                btnBack.style.border = 'none';
                btnBack.style.textDecoration = 'underline';
                btnBack.innerText = '‚Üê Change Pick';
                btnBack.onclick = () => { state.phase = 'PICK'; saveState(); };
                actionArea.appendChild(btnBack);

            } else if (state.phase === 'FINISHED') {
                actionArea.innerHTML = `<h3 style="color:var(--success)">Round Complete!</h3><p>Check final scores below.</p>`;
            }

            // Scoreboard
            const scoreBody = document.getElementById('scoreboard-body');
            scoreBody.innerHTML = '';
            
            // Calc max score for highlighting
            const maxScore = state.players.length > 0 ? Math.max(...state.players.map(p => p.score)) : 0;

            state.players.forEach(p => {
                const row = document.createElement('div');
                row.className = 'score-row';
                
                let badges = '';
                if (state.gameActive && state.phase !== 'FINISHED') {
                    if (p.id === state.currentWolfId) badges += `<span class="wolf-badge">WOLF</span>`;
                    if (p.id === state.partnerId) badges += `<span class="partner-badge">PARTNER</span>`;
                }
                
                const isLeader = (p.score === maxScore && p.score > 0);
                const scoreStyle = isLeader ? 'color: var(--success); font-weight:bold;' : '';

                row.innerHTML = `
                    <div style="display:flex; align-items:center;">${p.name} ${badges}</div>
                    <div style="text-align: center;">-</div>
                    <div style="text-align: right; ${scoreStyle}">${p.score}</div>
                `;
                scoreBody.appendChild(row);
            });
        }

        // Render loop
        function render() {
            if (state.gameActive) renderGame();
            else renderSetup();
        }

        // Init
        loadState();

    </script>
</body>
</html>
